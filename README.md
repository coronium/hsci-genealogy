# IsisCB Academic Genealogy Explorer

A Flask web application for exploring academic genealogy relationships in the History of Science field, designed for conference booth use at the History of Science Society (HSS) conference.

## Features

- **Search by Name**: Find scholars by their name
- **Search by University**: See all scholars associated with a specific institution
- **Academic Lineage**: View advisor-student relationships and genealogy trees
- **Descendant Statistics**: See total descendants and generation depth
- **User Contributions**: Allow visitors to add missing information or corrections
- **Unicode Support**: Handle international names and diacritics

## Project Structure

```
.
├── app.py                      # Main Flask application
├── requirements.txt            # Python dependencies
├── render.yaml                # Render.com deployment config
├── Procfile                   # Alternative deployment config
├── templates/                 # HTML templates
│   ├── search.html           # Main search page
│   ├── person.html           # Person detail page
│   ├── edit.html             # Edit form
│   ├── add.html              # Add new person form
│   └── confirmation.html     # Thank you page
├── static/                    # CSS and static files
│   └── style.css             # Stylesheet
└── data/                      # Data directory (on persistent storage)
    ├── dissertations.csv     # Main data file (upload manually)
    ├── genealogy.db          # SQLite database (auto-generated)
    └── corrections_log.csv   # User submissions log
```

## Local Development

### Prerequisites

- Python 3.9 or higher
- pip

### Setup

1. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

2. Place your `dissertations.csv` file in the `data/` directory

3. Run the application:
   ```bash
   python app.py
   ```

4. Open your browser to `http://localhost:5001`

## Deployment to Render.com

### Prerequisites

- GitHub account
- Render.com account (free)
- Your `dissertations.csv` file ready

### Step 1: Push to GitHub

Follow the instructions in the deployment guide to push your code to GitHub.

### Step 2: Create Render Service

1. Log in to [Render.com](https://render.com)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Configure:
   - **Name**: academic-genealogy (or your preferred name)
   - **Runtime**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn app:app`
   - **Plan**: Free

### Step 3: Add Persistent Disk

1. In your Render service dashboard, go to "Disks"
2. Click "Add Disk"
3. Configure:
   - **Name**: data
   - **Mount Path**: `/opt/render/project/src/data`
   - **Size**: 1 GB
4. Click "Create"

### Step 4: Upload Your Data

1. In Render dashboard, go to "Shell"
2. Upload your `dissertations.csv` file to `/opt/render/project/src/data/`
3. Set environment variable `FORCE_REINIT=1` to force database initialization
4. Restart your service
5. Remove the `FORCE_REINIT` variable after successful initialization

### Step 5: Set Environment Variables

In your Render service settings, add:
- `SECRET_KEY`: (auto-generated by render.yaml, or create your own)
- `DATA_DIR`: `/opt/render/project/src/data`

## Data Management

### CSV File Format

Your `dissertations.csv` should be **tab-separated** with these columns:

- `ID`: Unique dissertation ID
- `Author_ID`: Unique author identifier
- `Author_Name`: Full name
- `Years`: Life years (e.g., "1900-1975")
- `Title`: Dissertation title
- `Year`: Completion year
- `School`: University name
- `School_ID`: Unique school identifier
- `Department`: Department name
- `Subject_broad`: Subject area
- `Advisor_ID_1` through `Advisor_ID_8`: Advisor identifiers
- `Advisor_Name_1` through `Advisor_Name_8`: Advisor names
- `Advisor_Role_1` through `Advisor_Role_8`: Roles (Advisor, Committee Member, etc.)

### Re-uploading Data

To update your dataset:

1. Upload new `dissertations.csv` to the data directory
2. Set environment variable `FORCE_REINIT=1`
3. Restart the service
4. Remove `FORCE_REINIT` variable

### Downloading Corrections

User submissions are logged to `data/corrections_log.csv`. To download:

1. Use Render's Shell to access the file
2. Use `cat /opt/render/project/src/data/corrections_log.csv` to view
3. Copy and save locally for review

## Configuration

### Environment Variables

- `SECRET_KEY`: Flask secret key (auto-generated in production)
- `DATA_DIR`: Path to data directory (default: `data`)
- `PORT`: Server port (auto-set by Render)
- `FLASK_ENV`: Set to `development` for debug mode
- `FORCE_REINIT`: Set to `1` to force database re-initialization

## Technical Details

### Database

- SQLite database auto-generated from CSV on first run
- Optimized with indexes for fast searches
- Normalized search (diacritics removed for matching)
- Recursive queries for descendant counting

### Performance

- Handles ~10,000 records efficiently
- Indexed searches for name and school
- Expected load: 100 concurrent users (conference booth)
- Free tier suitable for conference duration

### Security

- No authentication required for viewing
- User name required for submissions
- All edits logged but not applied automatically
- CSRF protection can be added if needed

## Troubleshooting

### Database not initializing

- Check that `dissertations.csv` exists in data directory
- Verify CSV is tab-separated (not comma-separated)
- Check column names match exactly
- Look at logs for error messages

### Data not showing

- Ensure database was created (check for `genealogy.db`)
- Verify persistent disk is mounted correctly
- Check application logs in Render dashboard

### Slow performance

- Check if free tier has spun down (cold start)
- Upgrade to paid tier for guaranteed uptime
- Consider adding caching for frequently accessed pages

## License

Created for the History of Science Society conference booth.

## Contact

For questions about deployment or data format, contact [your contact info].
